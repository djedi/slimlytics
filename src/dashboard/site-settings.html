---
layout: base.njk
title: Site Settings
---

<div class="container" x-data="siteSettings()" x-init="init()">
    <!-- Header -->
    <div class="header">
        <div style="display: flex; align-items: center; gap: 20px;">
            <a href="/"><img src="/images/slimlytics.png" alt="Slimlytics" style="height: 40px; width: auto;"></a>
            <h1 style="font-size: 24px; color: #2c3e50; margin: 0;">Site Settings</h1>
        </div>
        <a href="/" style="background: #6c757d; color: white; text-decoration: none; padding: 8px 16px; border-radius: 5px; font-size: 14px;">
            ‚Üê Back to Dashboard
        </a>
    </div>

    <!-- Loading State -->
    <div x-show="loading" class="card" style="text-align: center; padding: 40px;">
        <span style="font-size: 24px;">‚è≥</span>
        <p style="margin-top: 10px; color: #7f8c8d;">Loading site settings...</p>
    </div>

    <!-- Settings Content -->
    <div x-show="!loading && site" x-cloak style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">

        <!-- Left Column -->
        <div>
            <!-- Site Information -->
            <div class="card">
                <div class="card-header">
                    <span class="emoji-icon">‚öôÔ∏è</span>
                    Site Information
                </div>

                <form @submit.prevent="updateSite()">
                    <div style="margin-bottom: 20px;">
                        <label for="siteName" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">
                            Site Name
                        </label>
                        <input type="text"
                               id="siteName"
                               x-model="site.name"
                               required
                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label for="siteUrl" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">
                            Site Domain
                        </label>
                        <input type="text"
                               id="siteUrl"
                               x-model="site.domain"
                               required
                               placeholder="example.com"
                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                    </div>

                    <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="color: #7f8c8d; font-size: 13px;">Site ID:</span>
                            <span style="font-family: monospace; font-size: 13px;" x-text="site.id"></span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #7f8c8d; font-size: 13px;">Created:</span>
                            <span style="font-size: 13px;" x-text="formatDate(site.created_at)"></span>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button"
                                @click="resetForm()"
                                style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                            Cancel
                        </button>
                        <button type="submit"
                                style="background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 600;"
                                :disabled="updateLoading">
                            <span x-show="!updateLoading">üíæ Save Changes</span>
                            <span x-show="updateLoading">‚è≥ Saving...</span>
                        </button>
                    </div>
                </form>

                <div x-show="updateSuccess" x-cloak
                     style="margin-top: 15px; padding: 10px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 5px; color: #155724;">
                    <span class="emoji-icon">‚úÖ</span> Settings updated successfully!
                </div>

                <div x-show="updateError" x-cloak
                     style="margin-top: 15px; padding: 10px; background: #fee; border: 1px solid #fcc; border-radius: 5px; color: #c00;">
                    <span class="emoji-icon">‚ö†Ô∏è</span> <span x-text="updateError"></span>
                </div>
            </div>

            <!-- Tracking Code -->
            <div class="card">
                <div class="card-header">
                    <span class="emoji-icon">üìä</span>
                    Tracking Code
                </div>

                <p style="margin-bottom: 15px; color: #7f8c8d; font-size: 14px;">
                    Add this code to your website, just before the closing &lt;/body&gt; tag:
                </p>

                <div style="position: relative;">
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; border: 1px solid #dee2e6; font-size: 12px;"><code x-text="trackingCode"></code></pre>
                    <button @click="copyTrackingCode()"
                            style="position: absolute; top: 10px; right: 10px; background: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px;">
                        <span x-text="copyButtonText"></span>
                    </button>
                </div>

                <div style="margin-top: 15px; padding: 15px; background: #e7f3ff; border-radius: 5px; border-left: 4px solid #3498db;">
                    <div style="font-weight: 600; margin-bottom: 5px; color: #2c3e50;">
                        üí° Pro Tip
                    </div>
                    <div style="font-size: 13px; color: #495057;">
                        For single-page applications, our tracking script automatically detects route changes.
                        You can also manually track events using <code style="background: #fff; padding: 2px 4px; border-radius: 3px;">window.slimlytics.trackEvent('event_name', data)</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div>
            <!-- Statistics Overview -->
            <div class="card">
                <div class="card-header">
                    <span class="emoji-icon">üìà</span>
                    Site Statistics
                </div>

                <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr);">
                    <div class="stat-item">
                        <div class="stat-value" x-text="stats.totalPageViews || '0'">0</div>
                        <div class="stat-label">Total Page Views</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" x-text="stats.uniqueVisitors || '0'">0</div>
                        <div class="stat-label">Unique Visitors</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" x-text="stats.avgTimeOnSite || '0s'">0s</div>
                        <div class="stat-label">Avg. Time on Site</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" x-text="stats.bounceRate || '0%'">0%</div>
                        <div class="stat-label">Bounce Rate</div>
                    </div>
                </div>

                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                    <a :href="`/?site=${site.id}`"
                       style="display: block; text-align: center; background: #3498db; color: white; text-decoration: none; padding: 10px; border-radius: 5px; font-weight: 600;">
                        üìä View Full Analytics
                    </a>
                </div>
            </div>

            <!-- Data Management -->
            <div class="card">
                <div class="card-header">
                    <span class="emoji-icon">üóÇÔ∏è</span>
                    Data Management
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: #2c3e50;">Export Data</h4>
                    <p style="margin-bottom: 10px; color: #7f8c8d; font-size: 14px;">
                        Download your analytics data in various formats:
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <button @click="exportData('csv')"
                                style="background: #28a745; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; font-size: 13px;">
                            üìÑ Export as CSV
                        </button>
                        <button @click="exportData('json')"
                                style="background: #17a2b8; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; font-size: 13px;">
                            üìã Export as JSON
                        </button>
                    </div>
                </div>

                <div style="padding-top: 20px; border-top: 1px solid #e9ecef;">
                    <h4 style="margin-bottom: 10px; color: #2c3e50;">Clear Data</h4>
                    <p style="margin-bottom: 10px; color: #7f8c8d; font-size: 14px;">
                        Remove analytics data for this site:
                    </p>
                    <button @click="showClearDataModal = true"
                            style="background: #ffc107; color: #000; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 13px;">
                        üßπ Clear Analytics Data
                    </button>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="card" style="border: 1px solid #dc3545;">
                <div class="card-header" style="background: #fff5f5; color: #dc3545;">
                    <span class="emoji-icon">‚ö†Ô∏è</span>
                    Danger Zone
                </div>

                <p style="margin-bottom: 15px; color: #7f8c8d; font-size: 14px;">
                    Once you delete a site, there is no going back. All analytics data will be permanently removed.
                </p>

                <button @click="showDeleteModal = true"
                        style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 600;">
                    üóëÔ∏è Delete This Site
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div x-show="showDeleteModal" x-cloak
         style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999;">
        <div class="card" style="max-width: 500px; margin: 20px;">
            <div class="card-header" style="background: #fff5f5; color: #dc3545;">
                <span class="emoji-icon">‚ö†Ô∏è</span>
                Confirm Site Deletion
            </div>

            <p style="margin-bottom: 15px;">
                Are you sure you want to delete <strong x-text="site.name"></strong>? This action cannot be undone.
            </p>

            <p style="margin-bottom: 20px; color: #7f8c8d; font-size: 14px;">
                To confirm, please type the site name: <strong x-text="site.name"></strong>
            </p>

            <input type="text"
                   x-model="deleteConfirmation"
                   placeholder="Type site name to confirm"
                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; margin-bottom: 20px;">

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button @click="showDeleteModal = false; deleteConfirmation = ''"
                        style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                    Cancel
                </button>
                <button @click="deleteSite()"
                        :disabled="deleteConfirmation !== site.name || deleteLoading"
                        style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 600;"
                        :style="deleteConfirmation !== site.name ? 'opacity: 0.5; cursor: not-allowed;' : ''">
                    <span x-show="!deleteLoading">Delete Site</span>
                    <span x-show="deleteLoading">Deleting...</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Clear Data Confirmation Modal -->
    <div x-show="showClearDataModal" x-cloak
         style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999;">
        <div class="card" style="max-width: 500px; margin: 20px;">
            <div class="card-header" style="background: #fff3cd; color: #856404;">
                <span class="emoji-icon">üßπ</span>
                Clear Analytics Data
            </div>

            <p style="margin-bottom: 15px;">
                This will remove all analytics data for <strong x-text="site.name"></strong>. The site configuration will remain.
            </p>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Clear data from:</label>
                <select x-model="clearDataRange"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                    <option value="all">All time</option>
                    <option value="30days">Last 30 days</option>
                    <option value="7days">Last 7 days</option>
                    <option value="today">Today only</option>
                </select>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button @click="showClearDataModal = false"
                        style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                    Cancel
                </button>
                <button @click="clearData()"
                        style="background: #ffc107; color: #000; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 600;">
                    Clear Data
                </button>
            </div>
        </div>
    </div>
</div>

<script src="/js/site-settings.js"></script>
